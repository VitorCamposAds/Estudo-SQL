-- MÓDULO 10

/* MANIPULANDO TEXTOS E DATAS NO SQL - NESSE MÓDULO VAMOS APRENDER A MANIPULAR TEXTOS (STRINGS) E DATAS NAS NOSSAS TABELAS: LEN EDATALENGHT,
CONCAT, LEFT/RIGHT, REPLACE, TRANSLATE E STUFF, UPPER E LOWER, FORMAT, CHARINDEX, SUBSTRING, TRIM, LTRIM, RTRIM, YEAR, MONTH, DAY,
DATEFROMPARTS, GETDATE, SYSDATETIME, DATEPART, DATEADD, DATEDIFF */

-- LEN - DATALENGHT - DESCUBRA A QUANTIDADE DE CARACTERES DA PALAVRA 'SQL HASHTAG'

SELECT LEN('SQL HASHTAG  ') AS 'LEN'
SELECT DATALENGTH('SQL HASHTAG  ') AS 'DATALENGHT' -- CONT ESPAÇOS ADICIONAIS NO FINAL DA PALAVRA

-- CONCAT: PERMITE JUNTAR MAIS DE UM TEXTO EM UMA ÚNICA PALAVRA
-- FAÇA UMA CONSULTA À TABELA DIMCUSTOMER ONDE SEJA POSSÍVEL VISUALIZAR O NOME COMPLETO DE CADA CLIENTE

SELECT
	FirstName AS 'NOME',
	LastName AS 'SOBRENOME',
	CONCAT(FirstName, ' ', LastName) AS 'NOME COMPLETO',
	EmailAddress AS 'EMAIL'
FROM DimCustomer

-- LEFT - EXTRAI UMA DETERMINADA QUANTIDADE DE CARACTERES DE UM TEXTO, DA ESQUERDA PARA A DIREITA
-- RIGHT - EXTRAI UMA DETERMINADA QUNTIDADE DE CARACTERES DE UM TEXTO, DA DIREITA PARA A ESQUERDA

-- FAÇA UMA CONSULTA À TABELA DIMPRODUCT E DIVIDA A COLUNA DE STYLENAME EM 2 PARTES:

SELECT * FROM DimProduct

SELECT LEFT('Product0101001', 7)
SELECT RIGHT('Product0101001', 7)

SELECT
	ProductName AS 'PRODUTO',
	UnitPrice AS 'PREÇO',
	LEFT(StyleName, 7) AS 'COD 1',
	RIGHT(StyleName, 7) AS 'COD2'
FROM
	DimProduct

-- REPLACE: SUBSTITUI UM DETERMINADO TEXTO POR OUTRO TEXTO - NO TEXTO: 'O EXCEL É O MELHOR!', SUBSTITUA EXCEL POR 'SQL'

SELECT REPLACE('O EXCEL É O MELHOR!', 'EXCEL', 'SQL')

/* CRIE UMA CONSULTA A PARTIR DE DIMCUSTOMER ONDE VOCÊ RETORNA O NOME COMPLETO DOS CLIENTES, A COLUNA DE SEXO(ABREV) E UMA OUTRA COLUNA DE SEXO
SUBSTITUINDO M PR MASCULINO E F POR FEMININO */

SELECT * FROM DimCustomer

SELECT
	FirstName AS 'Nome',
	LastName AS 'Sobrenome',
	Gender AS 'Sexo (Abrev.)',
	REPLACE(REPLACE(Gender, 'M', 'Masculino'), 'F', 'Feminino') AS 'Sexo'

FROM DimCustomer

-- TRANSLATE E STUFF: OUTRAS UNÇÕES DE SUBSTITUIÇÃO
-- TRANSLATE: SUBSTITUI CADA CARACTERE NA ORDEM ENCONTRADA NO TEXTO

SELECT TRANSLATE('10.241/444.124K23/1', './K', '---')
SELECT TRANSLATE('ABCD-490123', 'ABDC', 'WXYZ')


--STUFF - SUBSTITUI QUALQUER TEXTO COM UMA QUANTIDADE DE CARACTERES LIMITADOS, POR OUTRO TEXTO

SELECT STUFF('VBA IMPRESSIONADOR', 1, 3, 'EXCEL') -- PRIMEIRO PASSA O TEXTO. EM QUE POSIÇÃO COMEÇA O TEXTO. QUANTOS CARACTS TEM O TEXTO A SER SUBSTITUIDO. QUAL O NOVO TEXTO.
SELECT STUFF('SQL IMPRESSIONADOR', 1, 3, 'EXCEL')


SELECT
	STUFF('MT98-MOTO-G', 1, 2, 'CEL'),
	STUFF('AP01-IPHONE', 1, 2, 'CEL'),
	STUFF('SS61-SAMSUNG-GALAXY', 1, 2, 'CEL')


-- UPPER E LOWER - MAIÚSCULA E MINÚSCULA
--FAÇA UMA CONSULTA À TABELA DIMCUSTOMER E UTILIZE AS FUNÇÕES UPER E LOWER NA COLUNA DE FIRSTNAME E OBSERVE O RESULTADO

SELECT
	FirstName AS 'NOME',
	UPPER(FirstName) AS 'MAIÚSCULO',
	LOWER(FirstName) AS 'MINÚSCULO',
	EmailAddress AS 'EMAIL'
FROM
	DimCustomer

-- FORMAT - FORMATA UM VALOR DE ACORDO COM UMA FORMATAÇÃO

-- 1 FORMATAÇÃO DE NÚMERO: 5123

-- GERAL

SELECT FORMAT(5123, 'G')

-- NÚMERO

SELECT FORMAT(5123, 'N')

--MOEDA
SELECT FORMAT(5123, 'C')

-- FORMATAÇÃO DE DATA
--23/04/2020

--dd/MM/yyyy
SELECT FORMAT(CAST('23/04/2020' AS DATETIME), 'dddd/MM/yyyy', 'en-US') AS 'DATA'

-- DIA
SELECT FORMAT(CAST('23/04/2020' AS DATETIME), 'dddd', 'pt-BR') AS 'DIA' -- COM UPPER SÓ DE EXEMPLO

-- MÊS
SELECT FORMAT(CAST('23/04/2020' AS DATETIME), 'MMMM', 'pt-BR') AS 'MÊS'


-- ANO

SELECT FORMAT(CAST('23/04/2020' AS DATETIME), 'yyyy', 'pt-BR') AS 'ANO'

-- FORMATAÇÃO PERSONALIZADA - 1234567 --> 12-34-567

SELECT FORMAT(1234567, '##-###-##')

-- CHARINDEX: DESCOBRE A POSIÇÃO DE UM DETERMINADO CARACTERE DENTRO DE UM TEXTO
-- SUBSTRING: EXTRAI ALGUNS CARACTERES DE DENTRO DE UM TEXTO


SELECT 'Raquel Moreno' AS 'Nome'

-- Descubra a posição em que começa o sobrenome da Raquel utilizando a função CHARINDEX
SELECT CHARINDEX('M', 'Raquel Moreno')
SELECT CHARINDEX('Moreno', 'Raquel Moreno')

--Extraia o sobrenome da Rsquel utilizando a função substring
SELECT SUBSTRING('Raquel Moreno', 8, 6) AS 'SOBRENOME'

-- Combine as funções Charindex e Substring para extrair de forma automática quaquer sobrenome:

SELECT CHARINDEX(' ', 'Bernardo Cavalcanti') AS 'Posição'

SELECT SUBSTRING('Bernardo Calvalcanti', CHARINDEX(' ', 'Bernardo Cavalcanti') + 1, 100)  AS 'SOBRENOME'

-- COMO OTIMIZAR O EXERCÍCIO ACIMA UTILIZANDO VARIÁVEIS

DECLARE @varNome VARCHAR(100) = 'Vitor Campos'

SELECT SUBSTRING(@varNome, CHARINDEX(' ', @varNome) + 1, 100)  AS 'SOBRENOME'

-- FUNÇÕES PARA RETIRAR ESPAÇOS ADICIONAIS DENTRO DE UM TEXTO
-- TRIM: RETIRA ESPAÇOS ADICIONAIS À ESQUERDA E À DIREITA DO TEXTO
-- LTRIM: RETIRA ESPAÇOS ADICIONAIS À ESQUERDA DO TEXTO
-- RTRIM: RETIRA ESPAÇOS ADICIONAIS À DIREITA DO TEXTO

-- UTILIZE AS FUNÇÕES ACIMA NO CÓDIGO '  ABC123'

DECLARE @VarCodigo VARCHAR(50) = '  ABC123  '

SELECT
	TRIM(@VarCodigo) AS 'TRIM',
	LTRIM(@VarCodigo) AS 'LTRIM',
	RTRIM(@VarCodigo) AS 'RTRIM'


-- VER AS DIFERENÇAS

DECLARE @VarCodigo VARCHAR(50) = '  ABC123  '

SELECT
	DATALENGTH(TRIM(@VarCodigo)) AS 'TRIM',
	DATALENGTH(LTRIM(@VarCodigo)) AS 'LTRIM',
	DATALENGTH(RTRIM(@VarCodigo)) AS 'RTRIM'


-- UTILIZE AS FUNÇÕES DAY, MONTH E YEAR PARA DESCOBRIR O DIA, MÊS E ANO DA DATA: 18/05/2020

DECLARE @vardata DATETIME = '25/01/2020'

SELECT
	DAY(@vardata) AS 'DIA',
	MONTH(@vardata) AS 'MÊS',
	YEAR(@vardata) AS 'ANO'

-- UTILIZE A FUNÇÃO DATEFROMPARTS PARA OBTER UMA DATA A PARTIR DAS INFORMAÇÕES DE DIA, MÊS E ANO:

DECLARE @varDia int = 15,
		@varMes int = 6,
		@varAno int = 2017

SELECT DATEFROMPARTS(@varAno, @varMes, @varDia) AS 'DATA'

-- GETDATE - RETORNA A DATA/HORA ATUAL DO SISTEMA - SYSDATETIME - RETORNA A DATA/HORA ATUAL DO SISTEMA(MAIS PRECISO QUE A GETDATE)
-- DATENAME E DATEPART: RETORNAM INFORMAÇÕES(DIA, MÊS, ANO, SEMANA, ETC) DE UMA DATA

SELECT GETDATE()
SELECT SYSDATETIME()

-- DATENAME - RETORNA O RESULTADO EM FORMA DE TEXTO

DECLARE @varData DATETIME = GETDATE()

SELECT
	DATENAME(DAY, @varData) AS 'DATA ATUAL',
	DATENAME(MONTH, @varData) AS 'MÊS ATUAL',
	DATENAME(YEAR, @varData) AS 'ANO ATUAL',
	DATENAME(DAYOFYEAR, @varData) AS 'DIA DO ANO'


-- DATEPART - RETORNA EM FORMATO DE NÚMERO

DECLARE @varData DATETIME = GETDATE()

SELECT
	DATEPART(DAY, @varData) AS 'DATA ATUAL',
	DATEPART(MONTH, @varData) AS 'MÊS ATUAL',
	DATEPART(YEAR, @varData) AS 'ANO ATUAL',
	DATEPART(DAYOFYEAR, @varData) AS 'DIA DO ANO'

DECLARE @varData DATETIME = GETDATE()

SELECT SQL_VARIANT_PROPERTY(DATENAME(DAY, @varData), 'BaseType')
SELECT SQL_VARIANT_PROPERTY(DATEPART(DAY, @varData), 'BaseType')

--DATEADD - ADICIONA OU SUBTRAI UMA DETERMINADA QUANTIDADE DE DIAS, MESES OU ANOS A UMA DATA
--DATEDIFF: CALCULA A DIFERENÇA ENTRE AS DUAS DATAS

--DATEADD:

DECLARE 
	@varData1 DATETIME = '10/07/2020',
	@varData2 DATETIME = '05/03/2020',
	@varData3 DATETIME = '14/11/2021'

SELECT
	DATEADD(DAY, 30, @varData1),
	DATEADD(QUARTER, 30, @varData1),
	DATEADD(MONTH, 30, @varData1),
	DATEADD(DAY, -1, @varData1)

-- DATEDIFF

DECLARE 
	@varData1 DATETIME = '10/07/2020',
	@varData2 DATETIME = '05/03/2020',
	@varData3 DATETIME = '14/11/2021'

SELECT
	DATEDIFF(DAY, @varData2, @varData3),
	DATEDIFF(WEEK, @varData2, @varData3),
	DATEDIFF(YEAR, @varData2, @varData3)